<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hardware &mdash; KegScale 0.0.4 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3D Models" href="3d.html" />
    <link rel="prev" title="Software" href="software.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> KegScale
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="software.html">Software</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Hardware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#schema">Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#case">Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="#base-for-one">Base (for one)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#building-the-base">Building the base</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cat6-wire-usage">CAT6 Wire Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-the-display-case">Building the display case</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3d.html">3D Models</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">KegScale</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Hardware</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="hardware">
<span id="id1"></span><h1>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h1>
<p>This is the hardware schema that I have used in my build.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The software will adopt to what external sensors  are connected and will work with
one, two scales, one or two displays and with/without a temperature sensor.</p>
</div>
<p>I noticed that my first build was really unsable, it could vary +/- 2kg over time. I’ve already
added some features to the software to filter out the varying readings but these large changes are impossible
to fix with software.</p>
<p>The graph here shows two of my scales in my keezer where the second one (lower graph) is quite
stable over time. The first one is not. The difference is over 2 kg and it goes back to the previous
weight after a few hours.</p>
<a class="reference internal image-reference" href="_images/hx_drift.png"><img alt="Scale drift" src="_images/hx_drift.png" style="width: 600px;" /></a>
<p>So I’m currently trying to change the hardware setup in order to determine the source of the error. I found 3 main
types of HX711 boards.</p>
<a class="reference internal image-reference" href="_images/hx711-options.png"><img alt="HX711 boards" src="_images/hx711-options.png" style="width: 600px;" /></a>
<ul class="simple">
<li><p>Green: Most common board when searching for HX711</p></li>
<li><p>Red: Sparkfun board</p></li>
<li><p>Purple: A variation of the Sparkfun board</p></li>
</ul>
<p>The SparkFun board is the most expensive one but has one major advantage. You can power it on +5V and
configure it to use 3.3V digital signal levels (using VCC and VDD pins).</p>
<p>1. For my first build I used the Green board and placed that in the base of the scale. With this approach I
had issues with drift and varying readings. I built two scales and one had issues,the other not.</p>
<p>2. For the second build I moved the hx711 to the display case only keeping the load cells in the scale
base. I also changed to the purple board powered by 3.3V, currently that option works perfect with my
two first scales.</p>
<p>3. I discovered when running 2 scales that sharing the CLK signal to the HX711 was not a good idea, that introduced
errors in the accuracy. So in v0.4.0 I changes the CLK signal on the second scale to D8.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I’m currently updating the 3d model for the display case to fit the larger board.</p>
</div>
<div class="section" id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/schema.jpg"><img alt="Schema" src="_images/schema.jpg" style="width: 600px;" /></a>
<p>Part list:</p>
</div>
</div>
<div class="section" id="case">
<h1>Case<a class="headerlink" href="#case" title="Permalink to this headline">¶</a></h1>
<p>In this version the HX711 boards are moved to the case with the displays. The hope is that
this would stabilize the sensor readings and also make it easier to replace a faulty scale.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I will update the hardware design to fit a larger OLED display 1.3”. This will require a different
display driver on the software side. I’m also considering to update the software/design to an
ESP32 for more processing power.</p>
</div>
<ul class="simple">
<li><p>U1 - Wemos D1 mini (I used the v3.0 version)</p></li>
<li><p>U2 - 0.96” 128x64 I2C OLED display (with option to change i2c adress, 0x3c)</p></li>
<li><p>U3 - 0.96” 128x64 I2C OLED display (with option to change i2c adress, 0x3d)</p></li>
<li><p>R1 - 4.7k</p></li>
<li><p>R2 - 4.7k</p></li>
<li><p>2 x HX711 boards</p></li>
<li><p>3D printed case for displays and esp8266</p></li>
<li><p>5V power supply</p></li>
<li><p>RJ45 connectors (optional)</p></li>
</ul>
<p>R1 and R2 are just used to pull the CLK to +3.3V or the code will not detect
that scales are missing (floating input). You can use most values between
2k and 5k for that.</p>
<p>Images below shows examples of a HX711 board and RJ45 breakout board. I use the breakout board since I
havent yet created my own PCB, I want to stabilize the hardware design first.</p>
<a class="reference internal image-reference" href="_images/HX711_component.jpg"><img alt="HX711 board" src="_images/HX711_component.jpg" style="width: 300px;" /></a>
<p>If you are using the Sparkfun board I suggest that you power the HX711 board with +5V (VCC) and +3.3V (VDD)
so the digital interface is compatible with the ESP.</p>
<a class="reference internal image-reference" href="_images/rj45_board.jpg"><img alt="RJ45 board" src="_images/rj45_board.jpg" style="width: 300px;" /></a>
</div>
<div class="section" id="base-for-one">
<h1>Base (for one)<a class="headerlink" href="#base-for-one" title="Permalink to this headline">¶</a></h1>
<p>In this version the base is just a frame for the load cells and the temperature sensor.
Each base will have the same build process but only the temperature sensor of one will be used.</p>
<ul class="simple">
<li><p>3D printed base</p></li>
<li><p>3D printed cover</p></li>
<li><p>4 load cells</p></li>
<li><p>CAT6 network cable</p></li>
<li><p>U4 - DHT22 temp and humidity sensor (optional)</p></li>
<li><p>Load Combinator PCB (Optional)</p></li>
</ul>
<a class="reference internal image-reference" href="_images/loadcombinator_board.jpg"><img alt="Load Combinator board" src="_images/loadcombinator_board.jpg" style="width: 300px;" /></a>
<div class="section" id="building-the-base">
<h2>Building the base<a class="headerlink" href="#building-the-base" title="Permalink to this headline">¶</a></h2>
<p>Print the 2 base models and 2 covers. Files can be found in the sub-model directory.
These models are designed to be printed on my Prusa MK3s+ and support a Cornelius
kegs of 9, 18 or 19 l.</p>
<p>You can of course print or build a different mount for the load cells. Just check the
internet and you will find several options. Mount the load cells in the base and wire
the HX711 board to the load cells as shown in the next picture. Excellent guide on how to
<a class="reference external" href="https://learn.sparkfun.com/tutorials/load-cell-amplifier-hx711-breakout-hookup-guide/all">hook up loadcells and use the combinator board</a></p>
<p>First I start with soldering some wires to the DHT22 sensor so I can mount that in the base together with the load cells.</p>
<a class="reference internal image-reference" href="_images/dht22.jpg"><img alt="dht22" src="_images/dht22.jpg" style="width: 300px;" /></a>
<a class="reference internal image-reference" href="_images/keg_base_loadcell.jpg"><img alt="Load cells mounting" src="_images/keg_base_loadcell.jpg" style="width: 600px;" /></a>
<p>When you shorten the cables, make sure all of them are of the same length. Since the HX711 AD Converter will go in the display case the
network cable will extend these cables anyway.</p>
<a class="reference internal image-reference" href="_images/hx711.jpg"><img alt="HX711" src="_images/hx711.jpg" style="width: 600px;" /></a>
<p>I used a flat network cable (CAT6) for the connection between the bases and the HX711/ESP8266 and this is
what the result looked like. The cover will be glued on top of this at a later stage (preferably
when it works correcly).</p>
<a class="reference internal image-reference" href="_images/keg_base_wired.jpg"><img alt="Wired base" src="_images/keg_base_wired.jpg" style="width: 600px;" /></a>
<p>Now the base is built and the next step is to test the stability over time. I hook up the base and calibrate it to so I’m happy with the base load. Then I
let the weight rest on the scale for a couple of days to see how much deviation there is. In the software there is a feature for measuring the
stability over time (Config-&gt;Stability). Once you have calibrated and placed the weight on the scale, navigate to this menu item and clear the values. These will only
be reset at startup or when pressing the button.</p>
</div>
<div class="section" id="cat6-wire-usage">
<h2>CAT6 Wire Usage<a class="headerlink" href="#cat6-wire-usage" title="Permalink to this headline">¶</a></h2>
<p>I used the following wires in the network cable to connect to each base. I used the combinator board to hook
up all the cables from the load cells. You dont need that but I found it easier to keep track of what goes where.
The base is quite thin so I cannot fit an RJ45 connector on the board so i’m connecting the cable wires directly to the
combinator board.</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">CAT Wiring</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Wire</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Orange</p></td>
<td><p>Power to DHT22 (+3.3V)</p></td>
</tr>
<tr class="row-odd"><td><p>Orange-White</p></td>
<td><p>GND to DHT22 (GND)</p></td>
</tr>
<tr class="row-even"><td><p>Blue</p></td>
<td><p>A+ (or GRN on HX711)</p></td>
</tr>
<tr class="row-odd"><td><p>Blue-White</p></td>
<td><p>A- (or WHT on HX711)</p></td>
</tr>
<tr class="row-even"><td><p>Green</p></td>
<td><p>E+ (or RED on HX711)</p></td>
</tr>
<tr class="row-odd"><td><p>Green-White</p></td>
<td><p>E- (or BLK on HX711)</p></td>
</tr>
<tr class="row-even"><td><p>Brown</p></td>
<td><p>Signal from DHT22</p></td>
</tr>
<tr class="row-odd"><td><p>Brown-White</p></td>
<td><p>Not used</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="building-the-display-case">
<h2>Building the display case<a class="headerlink" href="#building-the-display-case" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This part will be updated once I have received my new 1.3” displays and changed the design to cover the HX711 boards. This section
is for the previous build with the HX711 in the scale base.</p>
</div>
<p>First step is to print the case parts and mount the OLED displays to the front. I use hot glue to fix the displays in place.</p>
<a class="reference internal image-reference" href="_images/oled_mount.jpg"><img alt="Mounting displays" src="_images/oled_mount.jpg" style="width: 600px;" /></a>
<p>The next step is to build the PCB where I used a standard experiment board with wire to build that up. I didnt want to spend time
on creating a PCB for the prototype. Might be something for the future. Just follow the schematic and validate your connections.</p>
<p>To make the connection easy with the scales I put on a rj45 (standard network connector) which I can just plug in to the display case.
There are other options available on the internet for both 1 and 2 displays.</p>
<a class="reference internal image-reference" href="_images/rj45_esp.jpg"><img alt="ESP and network" src="_images/rj45_esp.jpg" style="width: 600px;" /></a>
<p>This is the side which is mounted to the displays.</p>
<a class="reference internal image-reference" href="_images/front.jpg"><img alt="Front pcb" src="_images/front.jpg" style="width: 600px;" /></a>
<p>This is the finished part. (have not wired in the power supply yet)</p>
<a class="reference internal image-reference" href="_images/display_case.jpg"><img alt="Display build" src="_images/display_case.jpg" style="width: 600px;" /></a>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="software.html" class="btn btn-neutral float-left" title="Software" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3d.html" class="btn btn-neutral float-right" title="3D Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Magnus Persson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>