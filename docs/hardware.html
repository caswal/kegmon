<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="3D Models" href="3dmodels.html" /><link rel="prev" title="Getting started" href="intro.html" />

    <meta name="generator" content="sphinx-4.3.2, furo 2022.01.02"/>
        <title>Hardware - KegMon v0.6.0</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">KegMon v0.6.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/kegmon_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">KegMon v0.6.0</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="functionality.html">Functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Getting started</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="3dmodels.html">3D Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Software Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="q_and_a.html">Q &amp; A</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="hardware">
<span id="id1"></span><h1>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This is the hardware schema that I have used in my build.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The software will adopt to what external sensors are connected and will work with
one, two scales, one or two displays and with/without a temperature sensor.</p>
</div>
<p>I noticed that my first build was really unsable, it could vary +/- 2kg over time. I’ve already
added some features to the software to filter out the varying readings but these large changes are difficult
to fix with software. So I need to determine if this is related to software or hardware.</p>
<p>The graph here shows two of my scales in my keezer where the second one (lower graph) is quite
stable over time. The first one is not. The difference is over 2 kg and it goes back to the previous
weight after a few hours.</p>
<a class="reference internal image-reference" href="_images/hx_drift.png"><img alt="Scale drift" src="_images/hx_drift.png" style="width: 600px;"/></a>
<p>So I’m currently trying to change the hardware setup in order to determine the source of the error. I found 3 main
types of HX711 boards.</p>
<a class="reference internal image-reference" href="_images/hx711-options.png"><img alt="HX711 boards" src="_images/hx711-options.png" style="width: 600px;"/></a>
<ul class="simple">
<li><p>Green: Most common board when searching for HX711</p></li>
<li><p>Red: Sparkfun board</p></li>
<li><p>Purple: A variation of the Sparkfun board</p></li>
</ul>
<p>The SparkFun board is the most expensive one but has one major advantage. You can power it on +5V and
configure it to use 3.3V digital signal levels (using VCC and VDD pins).</p>
<p>1. For my first build I used the Green board and placed that in the base of the scale. With this approach I
had issues with drift and varying readings. I built two scales and one had issues,the other not.</p>
<p>2. For the second build I moved the hx711 to the display case only keeping the load cells in the scale
base. I also changed to the purple board powered by 3.3V, currently that option works perfect with my
two first scales.</p>
<p>3. I discovered when running 2 scales that sharing the CLK signal to the HX711 was not a good idea, that introduced
errors in the accuracy. So in v0.4.0 I changes the CLK signal on the second scale to D8.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I’m currently updating the 3d model for the display case to fit the larger board.</p>
</div>
</div>
<div class="section" id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/schema.jpg"><img alt="Schema" src="_images/schema.jpg" style="width: 600px;"/></a>
<p>Part list:</p>
</div>
<div class="section" id="case">
<h2>Case<a class="headerlink" href="#case" title="Permalink to this headline">¶</a></h2>
<p>In this version the HX711 boards are moved to the case with the displays. The hope is that
this would stabilize the sensor readings and also make it easier to replace a faulty scale.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I will update the hardware design to fit a larger OLED display 1.3”. This will require a different
display driver on the software side. I’m also considering to update the software/design to an
ESP32 for more processing power.</p>
</div>
<ul class="simple">
<li><p>U1 - Wemos D1 mini (I used the v3.0 version)</p></li>
<li><p>U2 - 0.96” 128x64 I2C OLED display (with option to change i2c adress, 0x3c)</p></li>
<li><p>U3 - 0.96” 128x64 I2C OLED display (with option to change i2c adress, 0x3d)</p></li>
<li><p>R1 - 4.7k</p></li>
<li><p>R2 - 4.7k</p></li>
<li><p>2 x HX711 boards</p></li>
<li><p>3D printed case for displays and esp8266</p></li>
<li><p>5V power supply</p></li>
<li><p>RJ45 connectors (optional)</p></li>
</ul>
<p>R1 and R2 are just used to pull the CLK to +3.3V or the code will not detect
that scales are missing (floating input). You can use most values between
2k and 5k for that.</p>
<p>Images below shows examples of a HX711 board and RJ45 breakout board. I use the breakout board since I
havent yet created my own PCB, I want to stabilize the hardware design first.</p>
<a class="reference internal image-reference" href="_images/HX711_component.jpg"><img alt="HX711 board" src="_images/HX711_component.jpg" style="width: 300px;"/></a>
<p>If you are using the Sparkfun board I suggest that you power the HX711 board with +5V (VCC) and +3.3V (VDD)
so the digital interface is compatible with the ESP.</p>
<a class="reference internal image-reference" href="_images/rj45_board.jpg"><img alt="RJ45 board" src="_images/rj45_board.jpg" style="width: 300px;"/></a>
<div class="section" id="building-the-display-case">
<h3>Building the display case<a class="headerlink" href="#building-the-display-case" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This part will be updated since in my new prototype im using two connections, one for each keg.</p>
</div>
<p>First step is to print the case parts and mount the OLED displays to the front. I use hot glue to fix the displays in place.</p>
<a class="reference internal image-reference" href="_images/oled_mount.jpg"><img alt="Mounting displays" src="_images/oled_mount.jpg" style="width: 600px;"/></a>
<p>The next step is to build the PCB where I used a standard experiment board with wire to build that up. I didnt want to spend time
on creating a PCB for the prototype. Might be something for the future. Just follow the schematic and validate your connections.</p>
<p>To make the connection easy with the scales I put on a rj45 (standard network connector) which I can just plug in to the display case.
There are other options available on the internet for both 1 and 2 displays.</p>
<a class="reference internal image-reference" href="_images/rj45_esp.jpg"><img alt="ESP and network" src="_images/rj45_esp.jpg" style="width: 600px;"/></a>
<p>This is the side which is mounted to the displays.</p>
<a class="reference internal image-reference" href="_images/front.jpg"><img alt="Front pcb" src="_images/front.jpg" style="width: 600px;"/></a>
<p>This is the finished part. (have not wired in the power supply yet)</p>
<a class="reference internal image-reference" href="_images/display_case.jpg"><img alt="Display build" src="_images/display_case.jpg" style="width: 600px;"/></a>
</div>
</div>
<div class="section" id="base-for-one">
<h2>Base (for one)<a class="headerlink" href="#base-for-one" title="Permalink to this headline">¶</a></h2>
<p>In this version the base is just a frame for the load cells and the temperature sensor.
Each base will have the same build process but only the temperature sensor of one will be used.</p>
<ul class="simple">
<li><p>3D printed base</p></li>
<li><p>3D printed cover</p></li>
<li><p>4 load cells</p></li>
<li><p>CAT6 network cable</p></li>
<li><p>U4 - DHT22 temp and humidity sensor (optional, alternative 1)</p></li>
<li><p>U4 - DS18B20 temp sensor (optional, alternative 2)</p></li>
<li><p>Load Combinator PCB (Optional)</p></li>
</ul>
<a class="reference internal image-reference" href="_images/loadcombinator_board.jpg"><img alt="Load Combinator board" src="_images/loadcombinator_board.jpg" style="width: 300px;"/></a>
<div class="section" id="building-the-base">
<h3>Building the base<a class="headerlink" href="#building-the-base" title="Permalink to this headline">¶</a></h3>
<p>Print the 2 base models and 2 covers. Files can be found in the sub-model directory.
These models are designed to be printed on my Prusa MK3s+ and support a Cornelius
kegs of 9, 18 or 19 l.</p>
<p>You can of course print or build a different mount for the load cells. Just check the
internet and you will find several options. Mount the load cells in the base and wire
the HX711 board to the load cells as shown in the next picture. Excellent guide on how to
<a class="reference external" href="https://learn.sparkfun.com/tutorials/load-cell-amplifier-hx711-breakout-hookup-guide/all">hook up loadcells and use the combinator board</a></p>
<p>First I start with soldering some wires to the DHT22 sensor so I can mount that in the base together with the load cells.</p>
<a class="reference internal image-reference" href="_images/dht22.jpg"><img alt="dht22" src="_images/dht22.jpg" style="width: 300px;"/></a>
<a class="reference internal image-reference" href="_images/keg_base_loadcell.jpg"><img alt="Load cells mounting" src="_images/keg_base_loadcell.jpg" style="width: 600px;"/></a>
<p>When you shorten the cables, make sure all of them are of the same length. Since the HX711 AD Converter will go in the display case the
network cable will extend these cables anyway.</p>
<a class="reference internal image-reference" href="_images/hx711.jpg"><img alt="HX711" src="_images/hx711.jpg" style="width: 600px;"/></a>
<p>I used a flat network cable (CAT6) for the connection between the bases and the HX711/ESP8266 and this is
what the result looked like. The cover will be glued on top of this at a later stage (preferably
when it works correcly).</p>
<a class="reference internal image-reference" href="_images/keg_base_wired.jpg"><img alt="Wired base" src="_images/keg_base_wired.jpg" style="width: 600px;"/></a>
<p>Now the base is built and the next step is to test the stability over time. I hook up the base and calibrate it to so I’m happy with the base load. Then I
let the weight rest on the scale for a couple of days to see how much deviation there is. In the software there is a feature for measuring the
stability over time (Config-&gt;Stability). Once you have calibrated and placed the weight on the scale, navigate to this menu item and clear the values. These will only
be reset at startup or when pressing the button.</p>
</div>
<div class="section" id="cat6-wire-usage">
<h3>CAT6 Wire Usage<a class="headerlink" href="#cat6-wire-usage" title="Permalink to this headline">¶</a></h3>
<p>I used the following wires in the network cable to connect to each base. I used the combinator board to hook
up all the cables from the load cells. You dont need that but I found it easier to keep track of what goes where.
The base is quite thin so I cannot fit an RJ45 connector on the board so i’m connecting the cable wires directly to the
combinator board.</p>
<div class="table-wrapper"><table class="docutils align-default" id="id2">
<caption><span class="caption-text">CAT Wiring</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Wire</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Orange</p></td>
<td><p>Power to DHT22 (+3.3V)</p></td>
</tr>
<tr class="row-odd"><td><p>Orange-White</p></td>
<td><p>GND to DHT22 (GND)</p></td>
</tr>
<tr class="row-even"><td><p>Blue</p></td>
<td><p>A+ (or GRN on HX711)</p></td>
</tr>
<tr class="row-odd"><td><p>Blue-White</p></td>
<td><p>A- (or WHT on HX711)</p></td>
</tr>
<tr class="row-even"><td><p>Green</p></td>
<td><p>E+ (or RED on HX711)</p></td>
</tr>
<tr class="row-odd"><td><p>Green-White</p></td>
<td><p>E- (or BLK on HX711)</p></td>
</tr>
<tr class="row-even"><td><p>Brown</p></td>
<td><p>Signal from DHT22 or DS18B20</p></td>
</tr>
<tr class="row-odd"><td><p>Brown-White</p></td>
<td><p>Not used</p></td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="3dmodels.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">3D Models</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="intro.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Getting started</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2022-23, Magnus Persson |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Hardware</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#schema">Schema</a></li>
<li><a class="reference internal" href="#case">Case</a><ul>
<li><a class="reference internal" href="#building-the-display-case">Building the display case</a></li>
</ul>
</li>
<li><a class="reference internal" href="#base-for-one">Base (for one)</a><ul>
<li><a class="reference internal" href="#building-the-base">Building the base</a></li>
<li><a class="reference internal" href="#cat6-wire-usage">CAT6 Wire Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    </body>
</html>